<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Check IP - Äáº¡i Ca</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      background: #f5f5f5;
      padding-top: 40px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      text-align: center;
      width: 90%;
      max-width: 500px;
      margin-bottom: 20px;
    }
    h1 { color: #333; }
    p { font-size: 18px; }
    #map { height: 300px; width: 100%; border-radius: 15px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ” IP Thiáº¿t Bá»‹ Cá»§a Báº¡n</h1>
    <p id="ip">Äang láº¥y IP...</p>
    <p id="location">Äang Ä‘á»‹nh vá»‹...</p>
  </div>
  <div class="card">
    <h2>ğŸ“ Báº£n Äá»“ Vá»‹ TrÃ­</h2>
    <div id="map">Äang táº£i báº£n Ä‘á»“...</div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(data => {
        const ip = data.ip;
        document.getElementById("ip").textContent = `ğŸ’¡ IP: ${ip}`;

        return fetch(`https://ipwho.is/${ip}`);
      })
      .then(res => res.json())
      .then(info => {
        const city = info.city || "KhÃ´ng rÃµ";
        const country = info.country || "KhÃ´ng rÃµ";
        const isp = info.connection?.isp || "KhÃ´ng rÃµ";
        const lat = info.latitude;
        const lon = info.longitude;

        document.getElementById("location").textContent =
          `ğŸ“ ${city}, ${country} - ğŸ›° ${isp}`;

        // Gá»­i log vá» Google Sheet
        fetch("https://script.google.com/macros/s/AKfycbzchDMqvHU6Bp86OhyfbK-kApcisX3VxloqhDVnWw2ezbW3oJGmPjf2PtMDx0_pn2gH/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            ip: info.ip,
            city: city,
            country: country,
            isp: isp
          })
        });

        // Hiá»ƒn thá»‹ báº£n Ä‘á»“ náº¿u cÃ³ tá»a Ä‘á»™
        if (lat && lon) {
          const map = L.map('map').setView([lat, lon], 10);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(map);
          L.marker([lat, lon]).addTo(map)
            .bindPopup(`${city}, ${country}`)
            .openPopup();
        } else {
          document.getElementById("map").innerHTML = "KhÃ´ng thá»ƒ hiá»ƒn thá»‹ báº£n Ä‘á»“.";
        }
      })
      .catch(err => {
        document.getElementById("ip").textContent = "KhÃ´ng thá»ƒ láº¥y IP.";
        document.getElementById("location").textContent = "KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­.";
        document.getElementById("map").innerHTML = "KhÃ´ng táº£i Ä‘Æ°á»£c báº£n Ä‘á»“.";
        console.error(err);
      });
  </script>
</body>
</html>
